<!DOCTYPE html>
<html>
<head>
  <title><%= content_for(:title) || "Vectors App" %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
</head>

<!-- Серый фон по всему body, flex-колонка для шапки + контента -->
<body class="min-h-screen bg-gray-300 flex flex-col">

<!-- Навбар -->
<nav class="bg-black shadow-md">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-center h-16">
      <!-- Центральное меню -->
      <div class="flex space-x-8">
        <%= link_to "Главная", root_path, class: "text-white hover:text-blue-500" %>
        <%= link_to "История", history_page_path, class: "text-white hover:text-blue-500" %>
        <%= link_to "Поддержка", support_page_path, class: "text-white hover:text-blue-500" %>
        <%= link_to "Профиль", profile_page_path, class: "text-white hover:text-blue-500" %>
      </div>
      <!-- Кнопка-гамбургер -->
      <button id="menu-toggle"
              class="absolute right-4 top-4 p-2 rounded-md text-white hover:text-blue-500 focus:outline-none">
        <!-- три полоски -->
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>
</nav>


<!-- Основное содержимое: калькулятор по центру -->
<main class="flex-grow flex items-start justify-start pt-55">
  <%= yield %>
</main>

<!-- Фон-оверлей (изначально скрыт) -->
<div id="sidebar-backdrop"
     class="fixed inset-0 bg-black bg-opacity-30
              opacity-0 pointer-events-none
              transition-opacity duration-300 ease-in-out
              z-40"></div>

<!-- Боковая панель (изначально за экраном справа) -->
<div id="sidebar"
     class="fixed inset-y-0 right-0 w-80 bg-white shadow-xl
              transform translate-x-full
              transition-transform duration-300 ease-in-out
              z-50 flex flex-col">
  <!-- Кнопка закрыть -->
  <div class="flex justify-end p-4">
    <button id="sidebar-close"
            class="text-gray-600 hover:text-gray-900 focus:outline-none"
            aria-label="Закрыть меню">
      ✕
    </button>
  </div>

  <!-- Контент панели -->
  <div class="px-6 pb-6">
    <% if user_signed_in? %>
      <!-- Пользователь уже залогинен -->
      <h2 class="text-xl font-bold mb-4">Здравствуйте, <%= current_user.email %>!</h2>
      <p class="mb-4">Вы уже в системе. Хотите выйти?</p>
      <%= button_to "Выйти", destroy_user_session_path, method: :delete,
                    class: "px-4 py-2 bg-red-600 text-white rounded-md" %>
    <% else %>
      <!-- Форма регистрации + таб авторизации -->
      <div class="flex space-x-2 mb-4">
        <button id="tab-register"
                class="flex-1 py-2 border-b-2 border-blue-600 font-medium">
          Регистрация
        </button>
        <button id="tab-login"
                class="flex-1 py-2 border-b-2 border-transparent text-gray-600 hover:text-gray-900">
          Вход
        </button>
      </div>

      <div id="form-register">
        <%= form_with url: registration_path, local: true do |f| %>
          <div class="mb-4">
            <%= f.label :email, "Email", class: "block text-sm font-medium" %>
            <%= f.email_field :email, class: "mt-1 block w-full border-gray-300 rounded-md" %>
          </div>
          <div class="mb-4">
            <%= f.label :password, "Пароль", class: "block text-sm font-medium" %>
            <%= f.password_field :password, class: "mt-1 block w-full border-gray-300 rounded-md" %>
          </div>
          <div class="flex justify-end">
            <%= f.submit "Зарегистрироваться",
                         class: "px-4 py-2 bg-blue-600 text-white rounded-md" %>
          </div>
        <% end %>
      </div>

      <div id="form-login" class="hidden">
        <%= form_with url: login_path, local: true do |f| %>
          <div class="mb-4">
            <%= f.label :email, "Email", class: "block text-sm font-medium" %>
            <%= f.email_field :email, class: "mt-1 block w-full border-gray-300 rounded-md" %>
          </div>
          <div class="mb-4">
            <%= f.label :password, "Пароль", class: "block text-sm font-medium" %>
            <%= f.password_field :password, class: "mt-1 block w-full border-gray-300 rounded-md" %>
          </div>

          <!-- Сюда вставляем новый код -->
          <div class="flex items-center justify-between">
            <%= f.submit "Войти",
                         class: "px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700" %>

            <%= link_to "Забыли пароль?", reset_password_path,
                        class: "text-sm text-blue-600 hover:underline" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<!-- Скрипт открытия/закрытия панели -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const tabReg    = document.getElementById("tab-register");
        const tabLog    = document.getElementById("tab-login");
        const formReg   = document.getElementById("form-register");
        const formLog   = document.getElementById("form-login");

        tabReg.addEventListener("click", () => {
            formReg.classList.remove("hidden");
            formLog.classList.add("hidden");
            tabReg.classList.replace("border-transparent", "border-blue-600");
            tabLog.classList.replace("border-blue-600", "border-transparent");
        });

        tabLog.addEventListener("click", () => {
            formLog.classList.remove("hidden");
            formReg.classList.add("hidden");
            tabLog.classList.replace("border-transparent", "border-blue-600");
            tabReg.classList.replace("border-blue-600", "border-transparent");
        });

        // открытие/закрытие боковой панели
        const toggle = document.getElementById("menu-toggle");
        const sidebar  = document.getElementById("sidebar");
        const backdrop = document.getElementById("sidebar-backdrop");
        const closeBtn = document.getElementById("sidebar-close");
        const open = () => {
            sidebar.classList.remove("translate-x-full");
            backdrop.classList.remove("opacity-0", "pointer-events-none");
            backdrop.classList.add("opacity-100");
        };
        const close = () => {
            sidebar.classList.add("translate-x-full");
            backdrop.classList.remove("opacity-100");
            backdrop.classList.add("opacity-0", "pointer-events-none");
        };
        toggle.addEventListener("click", open);
        closeBtn.addEventListener("click", close);
        backdrop.addEventListener("click", close);
    });
</script>

</body>
</html>